(this["webpackJsonphackernews-react-apollo"]=this["webpackJsonphackernews-react-apollo"]||[]).push([[0],{59:function(e,n,t){},60:function(e,n,t){},77:function(e,n,t){"use strict";t.r(n);var r=t(41),a=t(3),i=t(2),c=t(44),s=t.n(c),o=(t(59),t(60),t(19)),u=t(15),l=t(78),d=t.n(l),j=t(79),b=t(8),f=t(52),p="auth-token";function m(e){return function(e,n){var t=6e4,r=36e5,a=864e5,i=2592e6,c=31536e6,s=e-n;return s<2e4?"just now":s<t?"less than 1 min ago":s<r?Math.round(s/t)+" min ago":s<a?Math.round(s/r)+" h ago":s<i?Math.round(s/a)+" days ago":s<c?Math.round(s/i)+" mo ago":Math.round(s/c)+" years ago"}((new Date).getTime(),new Date(e).getTime())}function h(){var e=Object(u.a)(["\n  mutation VoteMutation($linkId: ID!) {\n    vote(linkId: $linkId) {\n      id\n      link {\n        id\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n      user {\n        id\n      }\n    }\n  }\n"]);return h=function(){return e},e}var O=d()(h()),v=function(e){var n=localStorage.getItem(p);return console.log(e.link),Object(a.jsxs)("div",{className:"flex mt2 items-start",children:[Object(a.jsxs)("div",{className:"flex items-center",children:[Object(a.jsxs)("span",{className:"gray",children:[e.index+1,"."]}),n&&Object(a.jsx)(j.a,{mutation:O,variables:{linkId:e.link.id},update:function(n,t){var r=t.data.vote;e.updateStoreAfterVote(n,r,e.link.id)},children:function(e){return Object(a.jsx)("div",{className:"ml1 gray f11",onClick:e,children:"\u25b2"})}})]}),Object(a.jsxs)("div",{className:"ml1",children:[Object(a.jsxs)("div",{children:[e.link.description," (",e.link.url,")"]}),Object(a.jsxs)("div",{className:"f6 lh-copy gray",children:[e.link.votes.length," votes | by"," ",e.link.postedBy?e.link.postedBy.name:"Unknown"," ",m(e.link.createdAt)]})]})]})};function x(){var e=Object(u.a)(["\n  subscription {\n    newVote {\n      id\n      link {\n        id\n        url\n        description\n        createdAt\n        postedBy {\n          id\n          name\n        }\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n      user {\n        id\n      }\n    }\n  }\n"]);return x=function(){return e},e}function g(){var e=Object(u.a)(["\n  subscription {\n    newLink {\n      id\n      url\n      description\n      createdAt\n      postedBy {\n        id\n        name\n      }\n      votes {\n        id\n        user {\n          id\n        }\n      }\n    }\n  }\n"]);return g=function(){return e},e}function k(){var e=Object(u.a)(["\n  {\n    feed {\n      links {\n        id\n        url\n        description\n        createdAt\n        postedBy {\n          id\n          name\n        }\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n    }\n  }\n"]);return k=function(){return e},e}var y=d()(k()),w=d()(g()),S=d()(x()),N=function(e){var n=function(e,n,t){var r=e.readQuery({query:y});r.feed.links.find((function(e){return e.id===t})).votes=n.link.votes,e.writeQuery({query:y,data:r})};return Object(a.jsx)(j.b,{query:y,children:function(e){var t=e.loading,r=e.error,i=e.data,c=e.subscribeToMore;return t?Object(a.jsx)("div",{children:"Fetching"}):r?(console.log(r),Object(a.jsx)("div",{children:"Error"})):(function(e){e({document:w,updateQuery:function(e,n){var t=n.subscriptionData;if(!t)return e;var r=t.data.newLink;return e.feed.links.find((function(e){return e.id===r.id}))?e:Object.assign({},e,{feed:{links:[r].concat(Object(f.a)(e.feed.links)),count:e.feed.links.length+1,__typename:e.feed.__typename}})}})}(c),function(e){e({document:S})}(c),i.feed.links.map((function(e,t){return Object(a.jsx)(v,{link:e,index:t,updateStoreAfterVote:n},e.id)})))}})};function C(){var e=Object(u.a)(["\n  mutation PostMutation($description: String!, $url: String!) {\n    post(description: $description, url: $url) {\n      id\n      url\n      description\n    }\n  }\n"]);return C=function(){return e},e}var $=d()(C()),I=function(e){var n=Object(i.useState)(""),t=Object(o.a)(n,2),r=t[0],c=t[1],s=Object(i.useState)(""),u=Object(o.a)(s,2),l=u[0],d=u[1],f=Object(b.f)();return Object(a.jsxs)("div",{children:[Object(a.jsxs)("div",{className:"mb2",children:[Object(a.jsx)("input",{className:"mb2",value:r,onChange:function(e){return c(e.target.value)},type:"text",placeholder:"A description for the link"}),Object(a.jsx)("input",{className:"mb2",value:l,onChange:function(e){return d(e.target.value)},type:"text",placeholder:"The URL for the link"})]}),Object(a.jsx)(j.a,{mutation:$,variables:{description:r,url:l},onCompleted:function(){return f.push("/")},update:function(e,n){var t=n.data.post,r=e.readQuery({query:y});r.feed.links.unshift(t),e.writeQuery({query:y,data:r})},children:function(e){return Object(a.jsx)("button",{onClick:e,children:"Submit"})}})]})},q=t(20),M=function(e){var n=localStorage.getItem(p),t=Object(b.f)();return Object(a.jsx)("div",{className:"flex pa1 justify-between nowrap orange",children:Object(a.jsxs)("div",{className:"flex flex-fixed black",children:[Object(a.jsx)("div",{className:"fw7 mr1",children:"Hacker News"}),Object(a.jsx)(q.b,{to:"/",className:"ml1 no-underline black",children:"new"}),Object(a.jsx)("div",{className:"ml1",children:"|"}),Object(a.jsx)(q.b,{to:"/search",className:"ml1 no-underline black",children:"search"}),n&&Object(a.jsxs)("div",{className:"flex",children:[Object(a.jsx)("div",{className:"ml1",children:"|"}),Object(a.jsx)(q.b,{to:"/create",className:"ml1 no-underline black",children:"submit"})]}),Object(a.jsx)("div",{className:"flex flex-fixed",children:n?Object(a.jsx)("div",{onClick:function(){localStorage.removeItem(p),t.push("/")},className:"ml1 pointer black"}):Object(a.jsx)(q.b,{to:"/login",className:"ml1 no-underline black",children:"login"})})]})})},B=t(23),A=t.n(B),L=t(31);function T(){var e=Object(u.a)(["\n  mutation LoginMutation($email: String!, $password: String!) {\n    login(email: $email, password: $password) {\n      token\n    }\n  }\n"]);return T=function(){return e},e}function D(){var e=Object(u.a)(["\n  mutation SignupMutation($email: String!, $password: String!, $name: String!) {\n    signup(email: $email, password: $password, name: $name) {\n      token\n    }\n  }\n"]);return D=function(){return e},e}var F=d()(D()),Q=d()(T()),P=function(e){var n=Object(i.useState)(""),t=Object(o.a)(n,2),r=t[0],c=t[1],s=Object(i.useState)(""),u=Object(o.a)(s,2),l=u[0],d=u[1],f=Object(i.useState)(""),m=Object(o.a)(f,2),h=m[0],O=m[1],v=Object(i.useState)(""),x=Object(o.a)(v,2),g=x[0],k=x[1],y=Object(b.f)(),w=function(){var e=Object(L.a)(A.a.mark((function e(n){var t,a;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=r?n.login:n.signup,a=t.token,S(a),y.push("/");case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),S=function(e){localStorage.setItem(p,e)};return Object(a.jsxs)("div",{children:[Object(a.jsx)("h4",{className:"mv3",children:r?"Login":"Sign Up"}),Object(a.jsxs)("div",{className:"flex flex-column",children:[!r&&Object(a.jsx)("input",{value:g,onChange:function(e){return k(e.target.value)},type:"text",placeholder:"Your name"}),Object(a.jsx)("input",{value:l,onChange:function(e){return d(e.target.value)},type:"text",placeholder:"Your email address"}),Object(a.jsx)("input",{value:h,onChange:function(e){return O(e.target.value)},type:"password",placeholder:"Choose a safe password"})]}),Object(a.jsxs)("div",{className:"flex mt3",children:[Object(a.jsx)(j.a,{mutation:r?Q:F,variables:{email:l,password:h,name:g},onCompleted:function(e){return w(e)},children:function(e){return Object(a.jsx)("div",{className:"pointer mr2 button",onClick:e,children:r?"login":"create account"})}}),Object(a.jsx)("div",{className:"pointer button",onClick:function(){return c(!r)},children:r?"need to create an account?":"already have an account?"})]})]})},V=t(32);function _(){var e=Object(u.a)(["\n  query FeedSearchQuery($filter: String!) {\n    feed(filter: $filter) {\n      links {\n        id\n        url\n        description\n        createdAt\n        postedBy {\n          id\n          name\n        }\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n    }\n  }\n"]);return _=function(){return e},e}var U=d()(_()),E=function(e){var n=Object(i.useState)([]),t=Object(o.a)(n,2),r=t[0],c=t[1],s=Object(i.useState)(""),u=Object(o.a)(s,2),l=u[0],d=u[1],j=Object(V.a)(),b=function(){var e=Object(L.a)(A.a.mark((function e(){var n,t;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.query({query:U,variables:{filter:l}});case 2:n=e.sent,t=n.data.feed.links,c(t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.jsxs)("div",{children:[Object(a.jsxs)("div",{children:["Search",Object(a.jsx)("input",{type:"text",onChange:function(e){return d(e.target.value)}}),Object(a.jsx)("button",{onClick:b,children:"OK"})]}),r.map((function(e,n){return Object(a.jsx)(v,{link:e,index:n},e.id)}))]})};var J=function(){return Object(a.jsxs)("div",{className:"center w85",children:[Object(a.jsx)(M,{}),Object(a.jsx)("div",{className:"ph3 pv1 background-gray",children:Object(a.jsxs)(b.c,{children:[Object(a.jsx)(b.a,{exact:!0,path:"/",component:N}),Object(a.jsx)(b.a,{exact:!0,path:"/create",component:I}),Object(a.jsx)(b.a,{exact:!0,path:"/login",component:P}),Object(a.jsx)(b.a,{exact:!0,path:"/search",component:E})]})})]})},Y=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,80)).then((function(n){var t=n.getCLS,r=n.getFID,a=n.getFCP,i=n.getLCP,c=n.getTTFB;t(e),r(e),a(e),i(e),c(e)}))},z=t(9),H=t(21),K=t(53),R=t(51),G=t(50),W=t(49),X=t(13),Z=t(1),ee=Object(K.a)({uri:"/graphql"}),ne=new W.a({uri:"ws:///subscriptions",options:{reconnect:!0,connectionParams:{authToken:localStorage.getItem(p)}}}),te=Object(G.a)((function(e,n){var t=n.headers,a=localStorage.getItem(p);return{headers:Object(r.a)(Object(r.a)({},t),{},{authorization:a?"Bearer ".concat(a):""})}})),re=Object(X.d)((function(e){var n=e.query,t=Object(Z.l)(n),r=t.kind,a=t.operation;return"OperationDefinition"===r&&"subscription"===a}),ne,te.concat(ee)),ae=new H.a({link:re,cache:new R.a});s.a.render(Object(a.jsx)(q.a,{children:Object(a.jsx)(z.a,{client:ae,children:Object(a.jsx)(J,{})})}),document.getElementById("root")),Y()}},[[77,1,2]]]);
//# sourceMappingURL=main.e3ff8965.chunk.js.map